spring.datasource.url=jdbc:postgresql://localhost:5432/mdvdb
spring.datasource.username=postgres
spring.datasource.password=12345
spring.datasource.driver-class-name=org.postgresql.Driver

spring.flyway.clean-disabled=true
spring.flyway.repair-on-migrate=true
spring.flyway.validate-on-migrate=false

spring.jpa.hibernate.ddl-auto=update
spring.jpa.generate-ddl=false
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
#spring.jpa.database-platform=org.hibernate.spatial.dialect.PostgisDialect
logging.level.org.hibernate.tool.hbm2ddl=DEBUG

spring.sql.init.mode=never

spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
file.upload-dir=uploads/

# Porta do servidor (pode ser sobrescrita pela variÃÂ¡vel de ambiente SERVER_PORT)
server.port=${SERVER_PORT:8081}

google.api.key=AIzaSyBmRqArryQ_2dMTRPBV_SlsviOa70w0IW4

# debug
logging.level.org.springframework.security=DEBUG

# ConfiguraÃÂ§ao do Cache
spring.cache.type=caffeine
spring.cache.cache-names=usuarios
spring.cache.caffeine.spec=maximumSize=500,expireAfterWrite=1h

# Habilita logs de cache para depuraÃÂ§ao
# logging.level.org.springframework.cache=DEBUG

# JWT Configuration
jwt.secret=4Z9kQe8rN6tYf2uV7sWm3xB1pL0cR5vTqS8hJ2dK6gF7bN9cU0wXyZ1aB2cD3eF4gH5iJ6kL
jwt.expiration=86400000
jwt.issuer=mapa-da-vida-api

# -----------------------------------------------------------------------------
# Email (SMTP) - configuraÃÂ§ÃÂ£o por variÃÂ¡veis de ambiente
# -----------------------------------------------------------------------------
# Use variÃÂ¡veis de ambiente (SPRING_MAIL_HOST, SPRING_MAIL_PORT, SPRING_MAIL_USERNAME, SPRING_MAIL_PASSWORD)
# para nÃÂ£o armazenar segredos no repositÃÂ³rio.

# Habilitar debug do JavaMail para ver a comunicaÃÂ§ÃÂ£o com o servidor SMTP (descomente para depurar)
# spring.mail.properties.mail.debug=true
# logging.level.org.springframework.mail=DEBUG
# logging.level.com.sun.mail=DEBUG

# ConfiguraÃÂ§ÃÂ£o real: valores carregados de variÃÂ¡veis de ambiente (ou deixados vazios se nÃÂ£o definidos)
spring.mail.host=${SPRING_MAIL_HOST:}
spring.mail.port=${SPRING_MAIL_PORT:}
spring.mail.username=${SPRING_MAIL_USERNAME:}
spring.mail.password=${SPRING_MAIL_PASSWORD:}
# SMTP auth / starttls (use true/false conforme provedor)
spring.mail.properties.mail.smtp.auth=${SPRING_MAIL_SMTP_AUTH:true}
spring.mail.properties.mail.smtp.starttls.enable=${SPRING_MAIL_STARTTLS:true}
# Em alguns provedores ÃÂ© ÃÂºtil confiar no host
spring.mail.properties.mail.smtp.ssl.trust=${SPRING_MAIL_SSL_TRUST:}
# Habilitar debug de JavaMail via variÃÂ¡vel de ambiente (SPRING_MAIL_DEBUG=true)
spring.mail.properties.mail.debug=${SPRING_MAIL_DEBUG:false}

# Configurações adicionais para evitar falha do Health check do Mail em dev quando não há credenciais
# Desabilita o HealthIndicator específico de email (útil se você não configurou SMTP em dev)
management.health.mail.enabled=false
# Alternativamente, pode apenas desabilitar o teste de conexão (impede a chamada a JavaMailSender.testConnection)
spring.mail.test-connection=false

# Exemplos de variáveis de ambiente para desenvolvimento (Mailtrap)
# SPRING_MAIL_HOST=smtp.mailtrap.io
# SPRING_MAIL_PORT=2525
# SPRING_MAIL_USERNAME=<MAILTRAP_USER>
# SPRING_MAIL_PASSWORD=<MAILTRAP_PASS>

# Para Gmail em produção: gere um App Password (requer 2FA) e exporte em SPRING_MAIL_PASSWORD
# SPRING_MAIL_HOST=smtp.gmail.com
# SPRING_MAIL_PORT=587
# SPRING_MAIL_SMTP_AUTH=true
# SPRING_MAIL_STARTTLS=true

# SugestÃÂ£o: crie um arquivo .env na raiz do projeto com as variÃÂ¡veis (veja .env.example) e rode .\load-env.ps1 no PowerShell para carregÃÂ¡-las na sessÃÂ£o.

# Exemplo rÃÂ¡pido para desenvolvimento (Mailtrap) - use como referÃÂªncia, nÃÂ£o commit
# spring.mail.host=smtp.mailtrap.io
# spring.mail.port=2525
# spring.mail.username=<MAILTRAP_USER>
# spring.mail.password=<MAILTRAP_PASS>
# spring.mail.properties.mail.smtp.auth=true
# spring.mail.properties.mail.smtp.starttls.enable=true

# Erros comuns e verificaÃÂ§ÃÂµes prÃÂ¡ticas
# 1) Se o log mostrar "Authentication failed" (como no debug que vocÃÂª anexou), use App Passwords (Gmail) ou credenciais corretas.
# 2) Para Gmail: gere um App Password (requere 2FA) e use ele em SPRING_MAIL_PASSWORD. "Less secure apps" foi descontinuado.
# 3) Para desenvolvimento local prefira Mailtrap ou smtp4dev/mailhog.
